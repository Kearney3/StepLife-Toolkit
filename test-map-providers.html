<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>åœ°å›¾æä¾›å•†æµ‹è¯•å·¥å…·</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
      background: #f5f5f5;
    }
    h1 {
      color: #333;
      text-align: center;
    }
    .test-container {
      background: white;
      border-radius: 8px;
      padding: 20px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      margin-bottom: 20px;
    }
    button {
      background: #1890ff;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 16px;
      margin: 10px 5px;
    }
    button:hover {
      background: #40a9ff;
    }
    button:disabled {
      background: #d9d9d9;
      cursor: not-allowed;
    }
    .results {
      margin-top: 20px;
    }
    .result-item {
      padding: 10px;
      margin: 5px 0;
      border-radius: 4px;
      border-left: 4px solid #d9d9d9;
    }
    .result-item.success {
      background: #f6ffed;
      border-left-color: #52c41a;
    }
    .result-item.fail {
      background: #fff1f0;
      border-left-color: #ff4d4f;
    }
    .result-item.testing {
      background: #e6f7ff;
      border-left-color: #1890ff;
    }
    .summary {
      margin-top: 20px;
      padding: 15px;
      background: #fafafa;
      border-radius: 4px;
    }
    .summary h3 {
      margin-top: 0;
    }
    .stats {
      display: flex;
      gap: 20px;
      margin-top: 10px;
    }
    .stat {
      flex: 1;
      text-align: center;
      padding: 10px;
      background: white;
      border-radius: 4px;
    }
    .stat-value {
      font-size: 24px;
      font-weight: bold;
      margin: 5px 0;
    }
    .stat-label {
      color: #666;
      font-size: 14px;
    }
  </style>
</head>
<body>
  <h1>ğŸ—ºï¸ åœ°å›¾æä¾›å•†æœåŠ¡æµ‹è¯•å·¥å…·</h1>
  
  <div class="test-container">
    <button id="testBtn" onclick="runTest()">å¼€å§‹æµ‹è¯•æ‰€æœ‰åœ°å›¾æä¾›å•†</button>
    <button onclick="clearResults()">æ¸…ç©ºç»“æœ</button>
    <div id="results" class="results"></div>
    <div id="summary" class="summary" style="display: none;">
      <h3>æµ‹è¯•ç»“æœæ±‡æ€»</h3>
      <div class="stats">
        <div class="stat">
          <div class="stat-value" id="totalCount">0</div>
          <div class="stat-label">æ€»è®¡</div>
        </div>
        <div class="stat">
          <div class="stat-value" id="successCount" style="color: #52c41a;">0</div>
          <div class="stat-label">å¯ç”¨</div>
        </div>
        <div class="stat">
          <div class="stat-value" id="failCount" style="color: #ff4d4f;">0</div>
          <div class="stat-label">ä¸å¯ç”¨</div>
        </div>
      </div>
    </div>
  </div>

  <script type="module">
    // åœ°å›¾æä¾›å•†é…ç½®
    const mapProviders = [
      { id: 'osm', name: 'OpenStreetMap', url: 'https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', subdomains: ['a', 'b', 'c'], coordinateSystem: 'WGS84' },
      { id: 'gaode', name: 'é«˜å¾·åœ°å›¾', url: 'https://webrd0{s}.is.autonavi.com/appmaptile?lang=zh_cn&size=1&scale=1&style=8&x={x}&y={y}&z={z}', subdomains: ['1', '2', '3', '4'], coordinateSystem: 'GCJ02' },
      { id: 'gaode_satellite', name: 'é«˜å¾·å«æ˜Ÿå›¾', url: 'https://webst0{s}.is.autonavi.com/appmaptile?style=6&x={x}&y={y}&z={z}', subdomains: ['1', '2', '3', '4'], coordinateSystem: 'GCJ02' },
      { id: 'tencent', name: 'è…¾è®¯åœ°å›¾', url: 'https://rt{s}.map.gtimg.com/tile?z={z}&x={x}&y={y}&type=vector&styleid=3', subdomains: ['0', '1', '2', '3'], coordinateSystem: 'GCJ02' },
      { id: 'tencent_satellite', name: 'è…¾è®¯å«æ˜Ÿå›¾', url: 'https://p{s}.map.gtimg.com/sateTiles/{z}/{x}/{y}/{x}_{y}.jpg', subdomains: ['0', '1', '2', '3'], coordinateSystem: 'GCJ02' },
      { id: 'google', name: 'Google Maps', url: 'https://mt{s}.google.com/vt/lyrs=m&x={x}&y={y}&z={z}', subdomains: ['0', '1', '2', '3'], coordinateSystem: 'WGS84' },
      { id: 'google_satellite', name: 'Google å«æ˜Ÿå›¾', url: 'https://mt{s}.google.com/vt/lyrs=s&x={x}&y={y}&z={z}', subdomains: ['0', '1', '2', '3'], coordinateSystem: 'WGS84' },
      { id: 'google_hybrid', name: 'Google æ··åˆå›¾', url: 'https://mt{s}.google.com/vt/lyrs=y&x={x}&y={y}&z={z}', subdomains: ['0', '1', '2', '3'], coordinateSystem: 'WGS84' },
      { id: 'cartodb', name: 'CartoDB Positron', url: 'https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', subdomains: ['a', 'b', 'c', 'd'], coordinateSystem: 'WGS84' },
      { id: 'cartodb_dark', name: 'CartoDB Dark Matter', url: 'https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', subdomains: ['a', 'b', 'c', 'd'], coordinateSystem: 'WGS84' },
      { id: 'esri', name: 'Esri WorldImagery', url: 'https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', subdomains: [], coordinateSystem: 'WGS84' },
      { id: 'esri_street', name: 'Esri WorldStreetMap', url: 'https://server.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer/tile/{z}/{y}/{x}', subdomains: [], coordinateSystem: 'WGS84' }
    ]

    async function testMapProvider(provider, timeout = 5000) {
      const testZ = 10
      const testX = 456
      const testY = 197
      
      let testUrl = provider.url
        .replace('{z}', testZ)
        .replace('{x}', testX)
        .replace('{y}', testY)
        .replace(/\{r\}/g, '')
      
      if (provider.subdomains && provider.subdomains.length > 0) {
        testUrl = testUrl.replace('{s}', provider.subdomains[0])
      } else {
        testUrl = testUrl.replace('{s}', '')
      }
      
      const startTime = Date.now()
      
      return new Promise((resolve) => {
        const img = new Image()
        const imgTimeout = setTimeout(() => {
          resolve({
            success: false,
            error: 'Timeout',
            responseTime: timeout,
            url: testUrl
          })
        }, timeout)
        
        img.onload = () => {
          clearTimeout(imgTimeout)
          resolve({
            success: true,
            responseTime: Date.now() - startTime,
            url: testUrl
          })
        }
        
        img.onerror = () => {
          clearTimeout(imgTimeout)
          resolve({
            success: false,
            error: 'Failed to load',
            responseTime: Date.now() - startTime,
            url: testUrl
          })
        }
        
        img.src = testUrl + (testUrl.includes('?') ? '&' : '?') + '_t=' + Date.now()
      })
    }

    window.runTest = async function() {
      const btn = document.getElementById('testBtn')
      const resultsDiv = document.getElementById('results')
      const summaryDiv = document.getElementById('summary')
      
      btn.disabled = true
      btn.textContent = 'æµ‹è¯•ä¸­...'
      resultsDiv.innerHTML = ''
      summaryDiv.style.display = 'none'
      
      let successCount = 0
      let failCount = 0
      
      for (const provider of mapProviders) {
        const item = document.createElement('div')
        item.className = 'result-item testing'
        item.innerHTML = `<strong>${provider.name}</strong> <span style="color: #666;">(${provider.coordinateSystem})</span> - æµ‹è¯•ä¸­...`
        resultsDiv.appendChild(item)
        
        const result = await testMapProvider(provider)
        
        item.className = `result-item ${result.success ? 'success' : 'fail'}`
        const status = result.success ? 'âœ…' : 'âŒ'
        const time = result.responseTime ? `${result.responseTime}ms` : 'N/A'
        const error = result.error ? ` - ${result.error}` : ''
        
        item.innerHTML = `${status} <strong>${provider.name}</strong> <span style="color: #666;">(${provider.coordinateSystem})</span> - ${time}${error}`
        
        if (result.success) {
          successCount++
        } else {
          failCount++
        }
        
        await new Promise(resolve => setTimeout(resolve, 100))
      }
      
      document.getElementById('totalCount').textContent = mapProviders.length
      document.getElementById('successCount').textContent = successCount
      document.getElementById('failCount').textContent = failCount
      summaryDiv.style.display = 'block'
      
      btn.disabled = false
      btn.textContent = 'å¼€å§‹æµ‹è¯•æ‰€æœ‰åœ°å›¾æä¾›å•†'
    }

    window.clearResults = function() {
      document.getElementById('results').innerHTML = ''
      document.getElementById('summary').style.display = 'none'
    }
  </script>
</body>
</html>

